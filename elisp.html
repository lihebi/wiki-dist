<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Emacs Lisp</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="assets/hebi.css" /><link rel="stylesheet" type="text/css" href="assets/test.css" /><link rel="stylesheet" type="text/css" href="../assets/hebi.css" /><link rel="stylesheet" type="text/css" href="../assets/test.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Emacs Lisp</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb11dee2">1. IO</a></li>
<li><a href="#org5076e25">2. Symbol</a></li>
<li><a href="#orgbf53ae9">3. Regular Expression</a></li>
<li><a href="#org0e1bf3f">4. Lisp Common Sense</a></li>
<li><a href="#org3940f63">5. string</a></li>
<li><a href="#org9c338d9">6. list</a></li>
<li><a href="#org10148a3">7. Sequence</a></li>
<li><a href="#org5bba225">8. Hash Table</a></li>
<li><a href="#org39a42f1">9. Function</a></li>
<li><a href="#orga3e3aca">10. Macro</a></li>
<li><a href="#orga278ce9">11. Control Structure</a></li>
<li><a href="#orgc0aeb23">12. Packages</a>
<ul>
<li><a href="#org2c176a3">12.1. Dash.el</a></li>
<li><a href="#orgcf1040b">12.2. s.el</a></li>
<li><a href="#orgec7f050">12.3. cl-lib.el loop</a>
<ul>
<li><a href="#orgccb91ad">12.3.1. general loop form</a></li>
<li><a href="#org28b5eff">12.3.2. for clauses</a></li>
<li><a href="#orga57d5b6">12.3.3. iteration clauses</a></li>
<li><a href="#orgf1eed06">12.3.4. accumulation clauses</a></li>
<li><a href="#org1dfb3c8">12.3.5. Other clauses</a></li>
</ul>
</li>
<li><a href="#org54a50e5">12.4. cl-lib other</a></li>
</ul>
</li>
<li><a href="#orgb50c1af">13. Debugging</a>
<ul>
<li><a href="#org85c16f9">13.1. lisp debugger</a></li>
<li><a href="#org13657f1">13.2. Edebug</a>
<ul>
<li><a href="#org6838791">13.2.1. breakpoints</a></li>
<li><a href="#org000dae8">13.2.2. Moving of point</a></li>
<li><a href="#orgae2f745">13.2.3. executions</a></li>
<li><a href="#org33d8288">13.2.4. evaluation</a></li>
<li><a href="#org8ca296f">13.2.5. other commands</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org14c076c">14. Unit Testing</a>
<ul>
<li><a href="#org5c50738">14.1. Write test</a></li>
<li><a href="#org4fa16a7">14.2. Run test</a></li>
</ul>
</li>
<li><a href="#org1bd76ca">15. Some random code snippets</a>
<ul>
<li>
<ul>
<li><a href="#org7b9c5e3">15.0.1. Url retrieval</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3eaa348">16. Emacs Related</a>
<ul>
<li><a href="#org00c0f6b">16.1. Buffer</a></li>
<li><a href="#org9a1f4e6">16.2. Position</a></li>
<li><a href="#org1396dfd">16.3. Marker</a></li>
<li><a href="#orgb709107">16.4. Process</a></li>
<li><a href="#orgf77ec99">16.5. File System Related</a>
<ul>
<li><a href="#orgb108acd">16.5.1. Traversing</a></li>
<li><a href="#orgdce1c29">16.5.2. Predicates</a></li>
</ul>
</li>
<li><a href="#org4546a8f">16.6. Other</a>
<ul>
<li><a href="#org458e637">16.6.1. make-obsolete-variable</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
In emacs lisp intro, the Robert J. Chassell quoted the following.
</p>

<blockquote>
<p>
I prefer to learn from reference manuals.  I “dive into” each
paragraph, and “come up for air” between paragraphs.
</p>

<p>
When I get to the end of a paragraph, I assume that that subject is
done, finished, that I know everything I need (with the possible
exception of the case when the next paragraph starts talking about it
in more detail).  I expect that a well written reference manual will
not have a lot of redundancy, and that it will have excellent pointers
to the (one) place where the information I want is.
</p>
</blockquote>

<div id="outline-container-orgb11dee2" class="outline-2">
<h2 id="orgb11dee2"><span class="section-number-2">1</span> IO</h2>
<div class="outline-text-2" id="text-1">
<p>
<code>princ</code> is for human, it print object without quotes. <code>print</code> is the
most verbose, print quotes and newlines. <code>prin1</code> omit the newlines.
If you just evaluate the print, the result is the object being
printing, so the echo area will have two copy of the object.
</p>

<p>
<code>message</code> accepts only string, and used inclusively on echo area.
</p>
</div>
</div>


<div id="outline-container-org5076e25" class="outline-2">
<h2 id="org5076e25"><span class="section-number-2">2</span> Symbol</h2>
<div class="outline-text-2" id="text-2">
<p>
Since elisp is lisp-1, a symbol can be both variable and a function at
the same time.  Macros and functions use the same namespace.
</p>

<p>
Elisp use nil in three ways: the symbol, the logical false, and the
empty list.
</p>

<p>
Elisp also has <code>#'</code>, but instead of syntax, it is the read syntax of
quoting for function, i.e. <code>function</code>.
</p>

<p>
Elisp by default uses <b>dynamic binding</b> and dynamic extent for local
variables. This means, the variable refers to the most recent local
binding, and a binding exists all the way as long as the binding form
is executing (e.g. body of let). <code>setq</code> works on the most recent
binding.
</p>

<p>
Thus, when using a local dynamic binding, always make sure (by
yourself, unfortunately) the variable is bound. When really using
global variable, <b>declare</b> it at the top, via <code>defvar</code> and
<code>defconst</code>. <code>defvar</code> will initialize the variable if it is originally
<i>void</i>, while <code>defconst</code> will unconditionally initialize it. Other
than that, there's no difference, the compiler will not complain if
you changed the constant. The variable will be marked as "special",
meaning that it will always have dynamic binding.  There's a third way
to create global binding, the <code>defcustom</code>. It is used to create
<i>customizable variable</i>, also called <i>user option</i>. It is special in
that, it is shown in customize interface, and the <code>defcustom</code> will
specify how it should be displayed, and what values to take.
</p>

<p>
On the other hand, lexical scope establish lexical binding, and has
indefinite extent. This means the variable has to refer to a binding
that is lexical written in scope. The binding is available even
outside the execution of the binding form, and construct a closure.
To enable lexical binding, you have to set buffer-local variable
<code>lexical-binding</code> to non-nil. Even after this, special variables are
still dynamic binding.
</p>

<p>
Emacs supports another binding, called buffer-local binding. As name
suggests, the binding is in effect when that buffer is the current
buffer, and goes out of effect when it is not. This is most useful in
major modes. Two ways can make buffer-local
variable. <code>make-local-variable</code> set the variable to local to current
buffer, while <code>make-variable-buffer-local</code> set a variable buffer-local
in all buffers.
</p>
</div>
</div>


<div id="outline-container-orgbf53ae9" class="outline-2">
<h2 id="orgbf53ae9"><span class="section-number-2">3</span> Regular Expression</h2>
<div class="outline-text-2" id="text-3">
<p>
You can use basic <code>.*+?</code>, as well as non-greedy counter part <code>*?</code>,
<code>+?</code>, <code>??</code>.
</p>

<p>
Bracket is special in elisp regex. Character classes can be used
inside <code>[]</code>. E.g. <code>[[:ascii:]]</code>.  Possible values include
</p>
<ul class="org-ul">
<li>ascii: 0-127</li>
<li>alnum: letter or digit</li>
<li>alpha: letter</li>
<li>blank: space and tab</li>
<li>digit: 0-9</li>
<li>lower: lower case</li>
<li>upper</li>
<li>punct</li>
<li>space: white space</li>
<li>word: same as <code>\w</code></li>
</ul>

<p>
Parenthesis and braces are not special, thus can be used
literally. When using for grouping, they need to be escaped for
capturing, otherwise it is literal. Non-capturing group is also
supported by <code>\(?:\)</code>. <code>\1</code> for back reference.
</p>

<p>
Back slash some code has special meanings. e.g. <code>\w</code> <code>\b</code>. The
uppercase is negation.
</p>
<ul class="org-ul">
<li><code>\w</code>: word</li>
<li><code>\b</code>:</li>
<li><code>\s-</code>: whitespace</li>
<li><code>\sw</code>: \w</li>
<li><code>\s.</code>: punctuation</li>
</ul>

<p>
When constructing regexp that match string literals, you can use
<code>regexp-quote</code> and <code>regexp-opt</code> to avoid getting specially
interpreted. <code>regexp-quote</code> returns a regular expression, whose only
exact match is string. <code>regexp-opt</code> returns an <i>efficient</i> regular
expression, that will matches any of the strings supplied.
</p>

<p>
The mostly used functions are <code>re-search-forward</code> and backward. It
search in the buffer. You can also search in a string by
<code>string-match</code> or <code>string-match-p</code>. They will set <i>match data</i>.  
</p>

<p>
After search, you can retrieve the previous match data by
<code>match-string</code> and <code>match-string-no-property</code> (for clean string). You
can also use <code>match-beginning</code> and <code>match-end</code> to get the position of
the match instead of content.
</p>

<p>
Finally, <code>replace-regexp-in-string</code> replaces all matches in a string.
</p>
</div>
</div>

<div id="outline-container-org0e1bf3f" class="outline-2">
<h2 id="org0e1bf3f"><span class="section-number-2">4</span> Lisp Common Sense</h2>
<div class="outline-text-2" id="text-4">
<p>
<code>eq</code>, <code>equal</code>, <code>=</code> are available.
</p>

<p>
Numeric function:
</p>
<ul class="org-ul">
<li>comparison: <code>max</code>, <code>min</code>, <code>abs</code></li>
<li>rounding: <code>truncate</code>, <code>floor</code>, <code>ceiling</code>, <code>round</code></li>
<li>arithmetic: <code>%</code>, <code>mod</code></li>
<li>bit-wise: <code>lsh</code>, <code>ash</code>, <code>logand</code>, <code>logior</code>, <code>logxor</code>, <code>lognot</code></li>
<li>math: <code>expt</code>, <code>exp</code>, <code>sin</code>, <code>cos</code>, <code>log</code>, <code>sqrt</code></li>
<li>random: <code>random</code></li>
</ul>
</div>
</div>



<div id="outline-container-org3940f63" class="outline-2">
<h2 id="org3940f63"><span class="section-number-2">5</span> string</h2>
<div class="outline-text-2" id="text-5">
<p>
Creating string by <code>make-string</code>. Most likely we are creating from
existing strings, e.g. <code>substring</code>, <code>concat</code>, <code>split-string</code>.  String
are compared using <code>string=</code>, <code>string&lt;</code> (no <code>string&gt;</code>?).  Converted by
<code>number-to-string</code>, <code>string-to-number</code>, and casing operations
<code>downcase</code>, <code>upcase</code>, <code>capitalize</code>.
</p>

<p>
Of course, the most powerful string construction function is
formating, with <code>foramt</code>, and <code>format-message</code>. The format string
follows C style though, using <code>%s</code> as printed representation
(<code>princ</code>), <code>%S</code> for <code>prin1</code>, <code>%c</code> for character, 
</p>
</div>
</div>

<div id="outline-container-org9c338d9" class="outline-2">
<h2 id="org9c338d9"><span class="section-number-2">6</span> list</h2>
<div class="outline-text-2" id="text-6">
<p>
List is defined as the last cdr to be <code>nil</code>.  If the last is not nil,
it is called <i>dotted list</i> instead of <i>improper list</i>.
</p>

<ul class="org-ul">
<li>append: the interesting part is, all arguments except the last one
are copied.  If you want to force copy the last one as well, add a
<code>nil</code> as the last of append.</li>
<li>reverse</li>
</ul>

<p>
list generation:
</p>
<ul class="org-ul">
<li>number-sequence: inclusive from a to b</li>
</ul>

<p>
Apart from <code>car</code> and <code>cdr</code>, elisp has <code>car-safe</code> and <code>cdr-safe</code>, that,
if the argument is not a cons cell, return nil.  <code>nth</code>, <code>nthcdr</code>,
<code>last</code> are available.
</p>

<p>
<i>destructive</i> means the cdr of the cons cells are modified.
</p>

<p>
<code>pop</code> and <code>push</code> is destructive. <code>pop</code> will return the car of the
list. <code>push</code> is the counter part for <code>cons</code> onto the
list. <code>add-to-list</code> only adds if the element is not there
already. There are also very bare-bone functions <code>setcar</code> and
<code>setcdr</code>. Note that <code>sort</code> is also destructive.
</p>

<p>
List can be, of course, used as set. <code>member</code> does predicate, <code>remove</code>
removes item from set, <code>delete</code> destructively removes. They use
<code>equal</code>, but have <code>eq</code> counter parts obviously. Finally, <code>delete-dups</code>
remove duplication.
</p>

<p>
Association list is same as scheme, a list of pairs. <code>assoc</code> can be
used to retrieve by <code>car</code>, while <code>rassoc</code> retrieve by <code>cdr</code>.
</p>

<p>
Property list is a flat list. The odd elements are property name, and
the even elements are values.  The property names <i>must</i> be unique.
The order of the "pairs" does not matter. <code>plist-get</code> and <code>plist-put</code>
modify the list. <code>plist-member</code> is useful because it can distinguish
the missing property and the property with value "nil"
</p>

<p>
A symbol can have a property list. It has a simpler syntax, <code>get</code> and
<code>put</code> with the symbol as argument. <code>symbol-plist</code> can retrieve the
plist from symbol, <code>setplist</code> gives a plist to a symbol.
</p>
</div>
</div>

<div id="outline-container-org10148a3" class="outline-2">
<h2 id="org10148a3"><span class="section-number-2">7</span> Sequence</h2>
<div class="outline-text-2" id="text-7">
<p>
Sequence is more general than list, specifically it also covers array.
<code>elt</code> is used to retrieve from sequence by position. <code>copy-sequence</code>
creates new sequence, but the elements are not copied.
</p>

<p>
Array is fixed length sequence, can be vector or string. <code>make-vector</code>
or <code>vector</code> constructs vector, and <code>aref</code> and <code>aset</code> access it.
</p>
</div>
</div>

<div id="outline-container-org5bba225" class="outline-2">
<h2 id="org5bba225"><span class="section-number-2">8</span> Hash Table</h2>
<div class="outline-text-2" id="text-8">
<p>
<code>make-hash-table</code> constructs a table, and access by <code>gethash</code>,
<code>puthash</code>, <code>remhash</code>, <code>clrhash</code>. Hash table can be counted by
<code>hash-table-count</code> instead of <code>length</code>, iterated by <code>maphash</code> instead
of <code>map</code>.
</p>
</div>
</div>

<div id="outline-container-org39a42f1" class="outline-2">
<h2 id="org39a42f1"><span class="section-number-2">9</span> Function</h2>
<div class="outline-text-2" id="text-9">
<p>
Functions are defined by following.  To specify optional argument, use
<code>&amp;optional</code> before all optional arguments. Collect rest arguments by
putting <code>&amp;rest</code> before the <b>final</b> argument.  A lambda expression
evaluates to a function object.
</p>

<pre class="example">
(defun name (var ...) body ...)
(lambda (arg ...) body ...)
(required-var ...
   [&amp;optional op-var ...]
   [&amp;rest rest-var])
</pre>

<p>
<code>apply</code> append the arguments into a list, and call the function with
the splice of list as arguments. The last argument must be a
list. <code>funcall</code> just call with the rest arguments.
</p>

<p>
<code>mapcar</code> is the typical map, return the list. <code>mapc</code> is used for side
effect. <code>mapconcat</code> is a shorthand for concatenate the result as a
string.
</p>


<p>
A function with <code>(interactive)</code> is a <i>command</i>, i.e. it can be
executed with M-x. This apply to both defun and lambda. Although
interactive is often used without argument, it can actually do very
interesting staff. It basically defines what kind of arguments the
user should provide to the command. Most likely, it is a multi-line
string containing key code of what kind of values to expect, and
prompt string. The numeric prefix argument "p" is just one of them,
and it can differentiate <code>C-u</code> prefix of the command.
</p>
</div>
</div>


<div id="outline-container-orga3e3aca" class="outline-2">
<h2 id="orga3e3aca"><span class="section-number-2">10</span> Macro</h2>
<div class="outline-text-2" id="text-10">
<p>
<code>defmacro name (args) body...</code>
</p>

<p>
The macro is very simple: leave the arguments <i>as is</i> and put them
into the macro body to form an expression. The expression is then
evaluated for result.
</p>
</div>
</div>

<div id="outline-container-orga278ce9" class="outline-2">
<h2 id="orga278ce9"><span class="section-number-2">11</span> Control Structure</h2>
<div class="outline-text-2" id="text-11">
<p>
Sequential structure has <code>progn</code>, <code>prog1</code>, <code>prog2</code>.
</p>

<p>
<code>if</code>, <code>when</code>, <code>unless</code>, <code>not</code>, <code>and</code>, <code>or</code> are common.
</p>

<p>
<code>cond</code> takes the following form
</p>
<pre class="example">
(cond (condition body ...) ...)
</pre>

<p>
<code>pcase</code> takes
</p>
<pre class="example">
(pcase exp (pat code ...) ...)
</pre>

<p>
Loops takes follows. There's no mention what is the return of
while. <code>dolist</code> does return the value of result, defaults to
nil. <code>dotimes</code> bind var to <code>[0,count)</code>.
</p>

<pre class="example">
(while condition forms ...)
(dolist (var list [result]) body ...)
(dotimes (var count [result]) body ...)
</pre>
</div>
</div>


<div id="outline-container-orgc0aeb23" class="outline-2">
<h2 id="orgc0aeb23"><span class="section-number-2">12</span> Packages</h2>
<div class="outline-text-2" id="text-12">
</div>
<div id="outline-container-org2c176a3" class="outline-3">
<h3 id="org2c176a3"><span class="section-number-3">12.1</span> Dash.el</h3>
<div class="outline-text-3" id="text-12-1">
<p>
<a href="https://github.com/magnars/dash.el">https://github.com/magnars/dash.el</a>
</p>

<p>
This is a collection of list libraries.
</p>

<ul class="org-ul">
<li><p>
<code>-map</code> takes a function to map over the list,
the anaphoric form with double dashes executed with <code>it</code> exposed as the list item. 
</p>
<div class="org-src-container">
<pre class="src src-elisp"> <span style="color: #b22222;">;; </span><span style="color: #b22222;">normal version</span>
 (-map (<span style="color: #a020f0;">lambda</span> (n) (* n n)) '(1 2 3 4))
 <span style="color: #b22222;">;; </span><span style="color: #b22222;">also works for defun, of course</span>
 (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">square</span> (n) (* n n))
 (-map 'square '(1 2 3 4))
 <span style="color: #b22222;">;; </span><span style="color: #b22222;">anaphoric version</span>
 (<span style="color: #a020f0;">--map</span> (* it it) '(1 2 3 4))
</pre>
</div></li>

<li><code>-update-at</code>: <code>(-update-at N FUNC LIST)</code> Return a list with element at Nth position in LIST replaced with `(func (nth n list))`.</li>
<li><code>-flatten</code>: <code>(-flatten L)</code>: Take a nested list L and return its contents as a single, flat list.</li>
</ul>
</div>
</div>

<div id="outline-container-orgcf1040b" class="outline-3">
<h3 id="orgcf1040b"><span class="section-number-3">12.2</span> s.el</h3>
<div class="outline-text-3" id="text-12-2">
<p>
<a href="https://github.com/magnars/s.el">https://github.com/magnars/s.el</a>
</p>

<p>
The string manipulation library
</p>
</div>
</div>

<div id="outline-container-orgec7f050" class="outline-3">
<h3 id="orgec7f050"><span class="section-number-3">12.3</span> cl-lib.el loop</h3>
<div class="outline-text-3" id="text-12-3">
<p>
This package ports many common lisp facilities into elisp,
most importantly, the loop facility.
So this section, at least for now, focus on <code>cl-loop</code>.
</p>
</div>

<div id="outline-container-orgccb91ad" class="outline-4">
<h4 id="orgccb91ad"><span class="section-number-4">12.3.1</span> general loop form</h4>
<div class="outline-text-4" id="text-12-3-1">
<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #a020f0;">cl-loop</span> clauses...)
</pre>
</div>
<p>
The clauses can be:
</p>
<ul class="org-ul">
<li>for clauses</li>
<li>TODO</li>
</ul>
</div>
</div>
<div id="outline-container-org28b5eff" class="outline-4">
<h4 id="org28b5eff"><span class="section-number-4">12.3.2</span> for clauses</h4>
<div class="outline-text-4" id="text-12-3-2">
<dl class="org-dl">
<dt><code>for VAR from FROM to TO by STEP</code></dt><dd><ul class="org-ul">
<li><code>FROM</code> defaults to 0. <code>STEP</code> must be positive and default to 1.</li>
<li>inclusive <code>[from,to]</code></li>
<li><code>from</code> can be <code>upfrom</code> and <code>downfrom</code>. I think it is wired to use this.</li>
<li><code>to</code> can be <code>upto</code> and <code>downto</code>. This makes more sense.</li>
<li><code>above</code> and <code>below</code> can be used, but <i>exclusive</i>. e.g. <code>for var below 10</code></li>
</ul></dd>
<dt><code>for VAR in LIST by FUNCTION</code></dt><dd><code>FUNCTION</code> is used to traverse the list, defaults to <code>cdr</code></dd>
<dt><code>for VAR on LIST by FUNCTION</code></dt><dd><code>VAR</code> is bound to the cons cell of the list instead of the element.</dd>
<dt><code>for VAR across ARRAY</code></dt><dd>iterates all elements of array</dd>
<dt><code>for VAR = EXPR1 then EXPR2</code></dt><dd>this is the most general form.
The <code>VAR</code> is bound to <code>EXPR1</code> initially, and will be set by evaluating <code>EXPR2</code> in successive iterations.
<code>EXPR2</code> can refer the old <code>VAR</code></dd>
</dl>
</div>
</div>

<div id="outline-container-orga57d5b6" class="outline-4">
<h4 id="orga57d5b6"><span class="section-number-4">12.3.3</span> iteration clauses</h4>
<div class="outline-text-4" id="text-12-3-3">
<dl class="org-dl">
<dt><code>repeat integer</code></dt><dd>repeat the loop how many times</dd>
<dt><code>while condition</code></dt><dd>stops the loop when the condition becomes nil</dd>
<dt><code>until condition</code></dt><dd></dd>

<dt><code>always condition</code></dt><dd>like while except it returns <code>nil</code>, and <code>finally</code> clauses are not executed.</dd>
<dt><code>never condition</code></dt><dd>counter part for <code>always</code></dd>
</dl>
</div>
</div>

<div id="outline-container-orgf1eed06" class="outline-4">
<h4 id="orgf1eed06"><span class="section-number-4">12.3.4</span> accumulation clauses</h4>
<div class="outline-text-4" id="text-12-3-4">
<dl class="org-dl">
<dt><code>collect form</code></dt><dd>collect into a list and return the list in the end</dd>
<dt><code>append form</code></dt><dd>collect the lists into a list by appending, and return it in the end</dd>
<dt><code>concat form</code></dt><dd>for string only</dd>
<dt><code>count form</code></dt><dd>count how many times form evaluates to non-nil.</dd>
<dt><code>sum form</code></dt><dd>sum all the values</dd>
<dt><code>maximize form</code></dt><dd>get the max. If the form is never executed, result is <i>undefined</i></dd>
<dt><code>minimize form</code></dt><dd></dd>
</dl>
</div>
</div>

<div id="outline-container-org1dfb3c8" class="outline-4">
<h4 id="org1dfb3c8"><span class="section-number-4">12.3.5</span> Other clauses</h4>
<div class="outline-text-4" id="text-12-3-5">
<dl class="org-dl">
<dt><code>with var = value</code></dt><dd>set the value one-time at the beginning of the loop.
Often used as return variable.
<b>The spaces around <code>=</code> is essential!</b>.</dd>
<dt><code>if condition clause [else clause]</code></dt><dd></dd>

<dt><code>when condition clause</code></dt><dd>same as if</dd>
<dt><code>unless condition clause</code></dt><dd>similar</dd>
<dt><code>initially [do] forms...</code></dt><dd>execute before the loop begins, but after the <code>for</code> and <code>with</code> variable bindings. <code>do</code> is optional.</dd>
<dt><code>finally [do] forms...</code></dt><dd>execute after the loop finishes</dd>
<dt><code>finally return form</code></dt><dd>finally return it &#x2026;</dd>
<dt><code>do forms...</code></dt><dd>execute as an implicit <code>progn</code> in the body</dd>
<dt><code>return form</code></dt><dd>this is often used in <code>if</code> or <code>unless</code>, because put it in top level will cause the loop always execute only once.</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-org54a50e5" class="outline-3">
<h3 id="org54a50e5"><span class="section-number-3">12.4</span> cl-lib other</h3>
<div class="outline-text-3" id="text-12-4">
<p>
Of course, cl-lib provides much more than just loops &#x2026;
</p>
<dl class="org-dl">
<dt><code>incf PLACE</code></dt><dd>is <code>i++</code></dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-orgb50c1af" class="outline-2">
<h2 id="orgb50c1af"><span class="section-number-2">13</span> Debugging</h2>
<div class="outline-text-2" id="text-13">
</div>
<div id="outline-container-org85c16f9" class="outline-3">
<h3 id="org85c16f9"><span class="section-number-3">13.1</span> lisp debugger</h3>
<div class="outline-text-3" id="text-13-1">
<p>
The simplest debugger is called <code>lisp debugger</code>.
You can turn on the <code>debug-or-error</code> flag,
but I found inserting the <code>(debug)</code> command useful.
Simply insert <code>(debug)</code> where you want program to suspend, and run it.
You will enter the debugger at that point.
In the debugger buffer, the following commands are available:
</p>
<dl class="org-dl">
<dt><code>c</code></dt><dd>continue run program</dd>
<dt><code>d</code></dt><dd>step</dd>
<dt><code>e</code></dt><dd>evaluate an prompt expression</dd>
<dt><code>R</code></dt><dd>like <code>e</code>, but also save the result in <code>*Debugger-record*</code></dd>
<dt><code>q</code></dt><dd>quit</dd>
<dt><code>v</code></dt><dd>toggle display of local variables ???</dd>
</dl>
</div>
</div>
<div id="outline-container-org13657f1" class="outline-3">
<h3 id="org13657f1"><span class="section-number-3">13.2</span> Edebug</h3>
<div class="outline-text-3" id="text-13-2">
<p>
For this to work, first you need to instrument the code.
You can instrument the defun by <code>C-u C-M-x</code>.
Actually this is adding a prefix before <code>eval-defun</code>,
which instrument, and then evaluate the defun.
</p>

<p>
After instrumentation, running the defun will cause the program to stop at the first <i>stop point</i> of the function.
The <i>stop points</i> are
</p>
<ul class="org-ul">
<li>before and after each subexpression that is a list</li>
<li>after each variable reference</li>
</ul>
</div>

<div id="outline-container-org6838791" class="outline-4">
<h4 id="org6838791"><span class="section-number-4">13.2.1</span> breakpoints</h4>
<div class="outline-text-4" id="text-13-2-1">
<dl class="org-dl">
<dt><code>b</code></dt><dd>set a breakpoint</dd>
<dt><code>u</code></dt><dd>unset a breakpoint</dd>
<dt><code>x CONDITION</code></dt><dd>set a conditional breakpoint</dd>
</dl>

<p>
You can also set the <i>source breakpoints</i>, by adding <code>(edebug)</code>.
</p>
</div>
</div>

<div id="outline-container-org000dae8" class="outline-4">
<h4 id="org000dae8"><span class="section-number-4">13.2.2</span> Moving of point</h4>
<div class="outline-text-4" id="text-13-2-2">
<dl class="org-dl">
<dt><code>B</code></dt><dd>move point to the next breakpoint</dd>
<dt><code>w</code></dt><dd>move point back to the current stop point</dd>
</dl>
</div>
</div>

<div id="outline-container-orgae2f745" class="outline-4">
<h4 id="orgae2f745"><span class="section-number-4">13.2.3</span> executions</h4>
<div class="outline-text-4" id="text-13-2-3">
<dl class="org-dl">
<dt><code>&lt;SPC&gt;</code></dt><dd>run to next stop point</dd>
<dt><code>g</code></dt><dd>execute until next breakpoint</dd>
<dt><code>q</code></dt><dd>exit</dd>
<dt><code>S</code></dt><dd>stop and wait for Edebug commands</dd>
<dt><code>n</code></dt><dd>evaluate a sexp and stop at stop point</dd>
<dt><code>t</code></dt><dd><i>trace</i>, pause one second at each stop point &#x2026;</dd>
<dt><code>T</code></dt><dd>rapid trace. Update the display at each stop point but don't actually pause &#x2026;</dd>
<dt><code>c</code></dt><dd>pause one second at each breakpoint</dd>
<dt><code>C</code></dt><dd>rapid continue.</dd>
<dt><code>G</code></dt><dd>run and ignore breakpoints (but you can stop it by <code>S</code>)</dd>

<dt><code>h</code></dt><dd>proceed to the stop point near the point &#x2026;</dd>
<dt><code>f</code></dt><dd>run one expression</dd>
<dt><code>o</code></dt><dd>step out the containing expression</dd>
<dt><code>i</code></dt><dd>step in</dd>
</dl>
</div>
</div>
<div id="outline-container-org33d8288" class="outline-4">
<h4 id="org33d8288"><span class="section-number-4">13.2.4</span> evaluation</h4>
<div class="outline-text-4" id="text-13-2-4">
<dl class="org-dl">
<dt><code>e EXP</code></dt><dd>evaluate a prompt expression</dd>
<dt><code>C-x C-e</code></dt><dd>evaluate an expression at point</dd>
</dl>
</div>
</div>

<div id="outline-container-org8ca296f" class="outline-4">
<h4 id="org8ca296f"><span class="section-number-4">13.2.5</span> other commands</h4>
<div class="outline-text-4" id="text-13-2-5">
<dl class="org-dl">
<dt><code>?</code></dt><dd>show help</dd>
<dt><code>r</code></dt><dd>redisplay the most recent sexp result</dd>
<dt><code>d</code></dt><dd>display the backtrace</dd>
</dl>
</div>
</div>
</div>
</div>



<div id="outline-container-org14c076c" class="outline-2">
<h2 id="org14c076c"><span class="section-number-2">14</span> Unit Testing</h2>
<div class="outline-text-2" id="text-14">
<p>
Use <code>ert</code> for unit testing.
</p>
</div>

<div id="outline-container-org5c50738" class="outline-3">
<h3 id="org5c50738"><span class="section-number-3">14.1</span> Write test</h3>
<div class="outline-text-3" id="text-14-1">
<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #a020f0;">ert-deftest</span> <span style="color: #0000ff;">addition-test</span>()
  <span style="color: #8b2252;">"Outline docstring."</span>
  (should (= (+ 1 2) 4)))
</pre>
</div>

<p>
The family of functions:
</p>
<ul class="org-ul">
<li><code>should</code></li>
<li><code>shoult-not</code></li>
<li><code>should-error</code></li>
</ul>

<p>
expected failure:
</p>
<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #a020f0;">ert-deftest</span> <span style="color: #0000ff;">addition-test</span>()
  <span style="color: #8b2252;">"Outline docstring."</span>
  <span style="color: #483d8b;">:expected-result</span> <span style="color: #483d8b;">:failed</span>
  (should (= (+ 1 2) 4)))
</pre>
</div>

<p>
skip test
</p>
<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #a020f0;">ert-deftest</span> <span style="color: #0000ff;">addition-test</span>()
  <span style="color: #8b2252;">"Outline docstring."</span>
  (slip-unless (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">dbusbind</span>'))
  (should (= (+ 1 2) 4)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4fa16a7" class="outline-3">
<h3 id="org4fa16a7"><span class="section-number-3">14.2</span> Run test</h3>
<div class="outline-text-3" id="text-14-2">
<p>
<code>M-x ert</code> will run it. The selector of test accept some more fancy staff like regular expression matching.
But in the case of scratch testing, I need to evaluate the deftest and then call <code>ert</code>.
</p>

<p>
The nice thing is it supports interactive debugging.
In the ert buffer, the following commands are available:
</p>
<dl class="org-dl">
<dt><code>r</code></dt><dd>re-run the test</dd>
<dt><code>.</code></dt><dd>jump to the source code of this test</dd>
<dt><code>b</code></dt><dd>show back-trace</dd>
<dt><code>m</code></dt><dd>show the message this test printed</dd>
<dt><code>d</code></dt><dd>re-run the test with debugger enabled</dd>
<dt>instrumentation</dt><dd>go to source code, type <code>C-u C-M-x</code>, and re-run the test. You are able to step!</dd>
</dl>

<p>
Also, select test by this:
</p>
<div class="org-src-container">
<pre class="src src-elisp">(ert-run-test (ert-get-test 'my-defined-test))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1bd76ca" class="outline-2">
<h2 id="org1bd76ca"><span class="section-number-2">15</span> Some random code snippets</h2>
<div class="outline-text-2" id="text-15">
<div class="org-src-container">
<pre class="src src-elisp">(cl-prettyprint (font-family-list)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">see all font family available on this system</span>
</pre>
</div>
</div>

<div id="outline-container-org7b9c5e3" class="outline-4">
<h4 id="org7b9c5e3"><span class="section-number-4">15.0.1</span> Url retrieval</h4>
<div class="outline-text-4" id="text-15-0-1">
<div class="org-src-container">
<pre class="src src-elisp">  (<span style="color: #a020f0;">with-current-buffer</span> (url-retrieve-synchronously <span style="color: #8b2252;">"http://scholar.google.com/scholar?q=segmented symbolic analysis"</span>)
    (goto-char (point-min))
    (kill-ring-save (point-min) (point-max))
    )
  (<span style="color: #a020f0;">let</span> ((framed-url (match-string 1)))
    (<span style="color: #a020f0;">with-current-buffer</span> (url-retrieve-synchronously framed-url)
      (goto-char (point-min))
      (<span style="color: #a020f0;">when</span> (re-search-forward <span style="color: #8b2252;">"&lt;frame src=\"</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">http[[:ascii:]]*?</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">\""</span>)
        (match-string 1))))
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org3eaa348" class="outline-2">
<h2 id="org3eaa348"><span class="section-number-2">16</span> Emacs Related</h2>
<div class="outline-text-2" id="text-16">
</div>
<div id="outline-container-org00c0f6b" class="outline-3">
<h3 id="org00c0f6b"><span class="section-number-3">16.1</span> Buffer</h3>
<div class="outline-text-3" id="text-16-1">
<ul class="org-ul">
<li><code>with-temp-buffer</code>
<code>(with-temp-buffer &amp;rest BODY)</code> Create a temporary buffer, and evaluate BODY there like <code>progn</code>.</li>

<li><code>(insert-file-contents FILENAME &amp;optional VISIT BEG END REPLACE)</code>: Insert contents of file FILENAME after point.</li>
<li><code>(secure-hash ALGORITHM OBJECT &amp;optional START END BINARY)</code>: the object can be a buffer.
This can be used to compare if a file has changed.</li>
<li><code>(current-buffer)</code>: Return the current buffer as a Lisp object.</li>
<li><code>(message FORMAT-STRING &amp;rest ARGS)</code>: Display a message at the bottom of the screen.</li>
</ul>

<p>
There will be many buffers in an Emacs session, and the
<code>current-buffer</code> returns the current one, which is the default target
for most commands. When you want to make something interesting to some
other buffer, you will need to <code>set-buffer</code> to set that buffer
current. You will likely want to switch back to the original buffer
after those operations, for that, don't use <code>set-buffer</code> to set back,
because it is not error-safe. Instead, use <code>save-current-buffer</code>, or
better <code>with-current-buffer</code>. <code>with-temp-buffer</code> don't need a provided
buffer object, but creates a temporary one. The temporary buffer will
be killed at the end of execution of body. All of these 3 form does
not display the buffer, just make it current.
</p>

<p>
A buffer has a name, retrieved by <code>buffer-name</code>. The name can be set
using <code>rename-buffer</code>. Buffers can be obtained by name via
<code>get-buffer</code>.  Buffers are also likely to be associated with a file,
and the non-directory file name is <code>buffer-file-name</code>. You can also
get the buffer using the file name via <code>get-file-buffer</code>. Since it
just the filename, there must be multiple ones, and this function
returns the first.
</p>

<p>
To create a buffer, use <code>get-buffer-create</code>, which returns the new
buffer, or an existing buffer. It does not make that buffer current.
Create a new unique buffer name by <code>generate-new-buffer-name</code>. It is
not typically directly used though. The function <code>generate-new-buffer</code>
uses that function to generate new name (by post-fixing &lt;N&gt;), if the
provided name is in use.
</p>

<p>
Obtain all the live buffers using <code>buffer-list</code>. The order of list
matters. The newly created buffer is added to the end of list, the
current displayed buffer moves to the front. When a buffer is buried,
it is moved to the end. <code>other-buffer</code> returns the first in the list
that is not current one. <code>last-buffer</code> returns the last (end) in the
list. <code>bury-buffer</code> and <code>unbury-buffer</code> moves a buffer to the end and
switch buffer to the last buffer respectively. A buffer is killed by
<code>kill-buffer</code>, in which case it is removed from the list.
</p>
</div>
</div>

<div id="outline-container-org9a1f4e6" class="outline-3">
<h3 id="org9a1f4e6"><span class="section-number-3">16.2</span> Position</h3>
<div class="outline-text-3" id="text-16-2">
<p>
A position is the index in a buffer. There of course will be a
character before and one after the position. When we say "at
position", we mean after position. Position in a buffer starts from 1,
while position in a string starts from 0.
</p>

<p>
The point is the current cursor position. <code>point</code> returns the current
point, <code>point-min</code> and <code>point-max</code> returns the beginning and end
point.
</p>

<p>
There are many commands to move point. <code>goto-char</code> moves by position,
and all other commands build upon it. I'm omitting the opposite
version, e.g. forward v.s. backward, up v.s. down., beginning v.s. end
</p>
<ul class="org-ul">
<li>moves by characters: <code>forward-char</code></li>
<li>moves by word: <code>forward-word</code></li>
<li>buffer: <code>beginning-of-buffer</code> moves to <code>point-min</code></li>
<li>line: <code>beginning-of-line</code> and <code>end-of-line</code>, <code>forward-line</code> and
<code>backward-line</code></li>
<li>screen: you can also count the current vertical screen lines, and
move the corresponding lines accordingly.</li>
<li>balanced expression: <code>forward-list</code>, <code>up-list</code>, <code>forward-sexp</code>,
<code>end-of-defun</code></li>
<li>skipping: <code>skip-chars-forward</code> skips over a list of chars
represented by a pattern string. It is like regular expression, but
is put implicitly inside brackets. Thus you can use for example
<code>"a-zA-Z"</code>.</li>
</ul>

<p>
It is useful to temporarily move to some position, do some tasks, and
move back. It is called <i>execursion</i>, and is done via
<code>save-execursion</code>.
</p>

<p>
Narrowing works with two positions. <code>narrow-to-region</code> does the
narrowing, and <code>widen</code> undoes it. This creates the following effects:
</p>
<ol class="org-ol">
<li>determine the accessible portion of the buffer, but don't alter the
position of the actual buffer.</li>
<li>The point cannot move outside the positions</li>
<li>no texts outside are displayed</li>
<li>most (?) functions refuse to operate on outside text</li>
</ol>
</div>
</div>


<div id="outline-container-org1396dfd" class="outline-3">
<h3 id="org1396dfd"><span class="section-number-3">16.3</span> Marker</h3>
<div class="outline-text-3" id="text-16-3">
<p>
A marker has two component: the buffer it is in, and the position in
the buffer. They can be retrieved by <code>marker-position</code> and
<code>marker-buffer</code>.
</p>

<p>
The position is updated automatically when the text changes. The
invariant is the surrounding two characters. The updating of marker
position takes time, especially there are a lot of them. Thus, remove
the marker if you know you won't use if any more.
</p>

<p>
You can make a marker by 4 functions, which differs only its initial
point. <code>make-marker</code>, <code>point-marker</code>, <code>point-min-marker</code>,
<code>point-max-marker</code>. You can also <code>copy-markder</code> from existing one. A
marker can be moved by <code>set-marker</code>.
</p>

<p>
There's one special marker, designated <i>the mark</i>, <b>whose position</b> is
returned by <code>mark</code>. To return the actual marker, use <code>mark-marker</code>,
but this is dangerous, try to avoid it. The mark is mainly used to
provide a default region for a command. The text between point and the
mark is called <i>the region</i>. The beginning and end of it can be
obtained by <code>region-beginning</code> and <code>region-end</code>. When using
<code>(interactive)</code> to define a command, the <code>"r"</code> code will give the
command two numeric values as the (point) and the mark, the smaller
first. This region is used for most region based command by
default.
</p>

<p>
Some command will set the mark, and when it does this, it will
typically save the old mark on the <i>mark ring</i>.  <code>set-mark</code> set the
position of the mark, but it is not commonly used, because it discard
the previous mark. Instead, <code>push-mark</code> and <code>pop-mark</code> handles the
mark ring automatically.
</p>
</div>
</div>

<div id="outline-container-orgb709107" class="outline-3">
<h3 id="orgb709107"><span class="section-number-3">16.4</span> Process</h3>
<div class="outline-text-3" id="text-16-4">
<p>
Elisp can create async or sync processes. There are three primitives
to create subprocess: <code>make-process</code> for async, <code>call-process</code> and
<code>call-process-region</code> for sync. All others are built upon them.
</p>

<p>
To get a list of current live async processes, use
<code>list-processes</code>. This seems to be for display purpose, and
<code>process-list</code> seems to return process objects. You can also get
process by its name via <code>get-process</code>. Process information can be
retrieved by <code>process-command</code>, <code>process-id</code>, <code>process-name</code>,
<code>process-status</code>, <code>process-live-p</code>, <code>process-type</code>,
<code>process-exit-status</code>.
</p>

<p>
You also want to communicate with the subprocess: either send input,
receive output, or send signals. To send string as input, use
<code>process-send-string</code>, <code>process-send-region</code>, <code>process-send-eof</code>. To
send signals, use <code>interrupt-process</code>, <code>kill-process</code>, <code>quit-process</code>,
<code>stop-process</code>, <code>continue-process</code>, or the general one
<code>signal-process</code>.
</p>

<p>
The output of a subprocess is inserted into a associated buffer,
called the <i>process buffer</i>. This buffer serves two purposes: receive
the output, and kill the process by kill the buffer. <code>process-buffer</code>
returns the buffer with a particular process, and <code>get-buffer-process</code>
returns the process object associated with the buffer. The position to
insert is determined by the process mark, which is always set to the
end of the buffer. You can set process buffer by <code>set-process-buffer</code>.
</p>

<p>
Network connection is also represented by a process object, but it is
not a child process, has no process id, cannot be killed or sent
signal. You can only send and receive data, or close the
connection. <code>make-network-process</code> creates network connection. It
seems to be a primitive, able to create TCP, UDP, or a
server. Alternatively, <code>open-network-stream</code> creates TCP specifically.
</p>
</div>
</div>


<div id="outline-container-orgf77ec99" class="outline-3">
<h3 id="orgf77ec99"><span class="section-number-3">16.5</span> File System Related</h3>
<div class="outline-text-3" id="text-16-5">
</div>
<div id="outline-container-orgb108acd" class="outline-4">
<h4 id="orgb108acd"><span class="section-number-4">16.5.1</span> Traversing</h4>
<div class="outline-text-4" id="text-16-5-1">
<div class="org-src-container">
<pre class="src src-elisp">(directory-files DIRECTORY <span style="color: #228b22;">&amp;optional</span> FULL MATCH NOSORT)
</pre>
</div>

<p>
Return a list of names of files in DIRECTORY.
</p>

<p>
Usage example:
</p>
<div class="org-src-container">
<pre class="src src-elisp">(bib-files (directory-files bib-dir t <span style="color: #8b2252;">".*\.bib$"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdce1c29" class="outline-4">
<h4 id="orgdce1c29"><span class="section-number-4">16.5.2</span> Predicates</h4>
<div class="outline-text-4" id="text-16-5-2">
<p>
<code>directory-files</code> will throw error if the directory does not exist.
So a safe way is to check if the directory exists first.
This predicate does this:
</p>
<div class="org-src-container">
<pre class="src src-elisp">(file-exists-p FILENAME)
</pre>
</div>
<p>
Directory is also a file.
</p>

<p>
Other predicates includes:
</p>
<pre class="example">
file-readable-p
file-executable-p
file-writable-p
file-accessible-directory-p
</pre>
</div>
</div>
</div>

<div id="outline-container-org4546a8f" class="outline-3">
<h3 id="org4546a8f"><span class="section-number-3">16.6</span> Other</h3>
<div class="outline-text-3" id="text-16-6">
<ul class="org-ul">
<li><code>(defalias SYMBOL DEFINITION &amp;optional DOCSTRING)</code>: Set SYMBOL's function definition to DEFINITION.
E.g. <code>(defalias 'helm-bibtex-get-value 'bibtex-completion-get-value)</code>,
serves as a temporary patch for <code>helm-bibtex</code> update its API to <code>bibtex-completion</code></li>
</ul>
</div>

<div id="outline-container-org458e637" class="outline-4">
<h4 id="org458e637"><span class="section-number-4">16.6.1</span> make-obsolete-variable</h4>
<div class="outline-text-4" id="text-16-6-1">
<p>
<code>(make-obsolete-variable OBSOLETE-NAME CURRENT-NAME WHEN &amp;optional ACCESS-TYPE)</code>
</p>

<p>
Make the byte-compiler warn that OBSOLETE-NAME is obsolete.
</p>

<p>
<code>helm-bibte</code> used it when it refactored the "helm" part off into a module,
to support different backend other than <code>helm</code>.
As a result, most <code>helm-bibtex-</code> prefixes are changed to <code>bibtex-completion-</code> ones.
But they want the end user's configuration will not break,
and at the same time warn them to update to the new name.
Here's the code, and the last line is what actually uses the function.
The actual effect is the user's configuration will be marked as warning,
the mini-buffer will describe the obsolete detail.
</p>

<div class="org-src-container">
<pre class="src src-elisp">  (<span style="color: #a020f0;">cl-loop</span>
   for var in '(<span style="color: #8b2252;">"bibliography"</span> <span style="color: #8b2252;">"library-path"</span> <span style="color: #8b2252;">"pdf-open-function"</span>
                <span style="color: #8b2252;">"pdf-symbol"</span> <span style="color: #8b2252;">"format-citation-functions"</span> <span style="color: #8b2252;">"notes-path"</span>
                <span style="color: #8b2252;">"notes-template-multiple-files"</span>
                <span style="color: #8b2252;">"notes-template-one-file"</span> <span style="color: #8b2252;">"notes-key-pattern"</span>
                <span style="color: #8b2252;">"notes-extension"</span> <span style="color: #8b2252;">"notes-symbol"</span> <span style="color: #8b2252;">"fallback-options"</span>
                <span style="color: #8b2252;">"browser-function"</span> <span style="color: #8b2252;">"additional-search-fields"</span>
                <span style="color: #8b2252;">"no-export-fields"</span> <span style="color: #8b2252;">"cite-commands"</span>
                <span style="color: #8b2252;">"cite-default-command"</span>
                <span style="color: #8b2252;">"cite-prompt-for-optional-arguments"</span>
                <span style="color: #8b2252;">"cite-default-as-initial-input"</span> <span style="color: #8b2252;">"pdf-field"</span>)
   for oldvar = (intern (concat <span style="color: #8b2252;">"helm-bibtex-"</span> var))
   for newvar = (intern (concat <span style="color: #8b2252;">"bibtex-completion-"</span> var))
   do
   (<span style="color: #a020f0;">defvaralias</span> <span style="color: #a0522d;">newvar</span> oldvar)
   (make-obsolete-variable oldvar newvar <span style="color: #8b2252;">"2016-03-20"</span>))
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="validation"></p>
</div>
</body>
</html>
