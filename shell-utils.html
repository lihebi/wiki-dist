<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-11-20 Mon 10:50 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Shell Utilities</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Hebi Li" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="assets/hebi.css" /><link rel="stylesheet" type="text/css" href="assets/test.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Shell Utilities</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org9f57786">1. Tmp</a></li>
<li><a href="#org91cff5a">2. Q&amp;A</a>
<ul>
<li><a href="#org336ee00">2.1. redirect output of time</a></li>
</ul>
</li>
<li><a href="#org347fbb0">3. Mathematics</a>
<ul>
<li><a href="#orgf46ec4d">3.1. random number generation</a></li>
</ul>
</li>
<li><a href="#org525127b">4. Text Editing</a>
<ul>
<li><a href="#orgde033e5">4.1. Patch System</a></li>
<li><a href="#org6b9c825">4.2. grep</a></li>
<li><a href="#org630a880">4.3. tr: translate characters</a></li>
<li><a href="#org84c141c">4.4. uniq: report or filter out repeated lines in a file</a></li>
<li><a href="#orgf0de125">4.5. Other</a></li>
</ul>
</li>
<li><a href="#orgf254733">5. System Management</a>
<ul>
<li><a href="#orgebeb393">5.1. man</a></li>
<li><a href="#org44214ae">5.2. sort</a></li>
<li><a href="#orgf3983ad">5.3. xargs</a></li>
<li><a href="#orgab7961c">5.4. Find</a></li>
<li><a href="#org524948d">5.5. Filesystem related</a></li>
<li><a href="#org6351ba5">5.6. unzip</a></li>
<li><a href="#org9026d7a">5.7. tar</a></li>
<li><a href="#org01dcf21">5.8. Other</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org9f57786" class="outline-2">
<h2 id="org9f57786"><span class="section-number-2">1</span> Tmp</h2>
<div class="outline-text-2" id="text-1">
<pre class="example">
find ~/data/fast/pick-master/ -name '*.[ch]'
</pre>

<ul class="org-ul">
<li>sort -k 4 -n</li>
</ul>
</div>
</div>

<div id="outline-container-org91cff5a" class="outline-2">
<h2 id="org91cff5a"><span class="section-number-2">2</span> Q&amp;A</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org336ee00" class="outline-3">
<h3 id="org336ee00"><span class="section-number-3">2.1</span> redirect output of time</h3>
<div class="outline-text-3" id="text-2-1">
<pre class="example">
{ time sleep 1 ; } 2&gt; time.txt
{ time sleep 1 ; } 2&gt;&amp;1 | tee -a time.txt
</pre>
</div>
</div>
</div>

<div id="outline-container-org347fbb0" class="outline-2">
<h2 id="org347fbb0"><span class="section-number-2">3</span> Mathematics</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgf46ec4d" class="outline-3">
<h3 id="orgf46ec4d"><span class="section-number-3">3.1</span> random number generation</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-shell">shuf -i 1-100 -n 1
</pre>
</div>
<ul class="org-ul">
<li><code>bc</code> calculator</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org525127b" class="outline-2">
<h2 id="org525127b"><span class="section-number-2">4</span> Text Editing</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgde033e5" class="outline-3">
<h3 id="orgde033e5"><span class="section-number-3">4.1</span> Patch System</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Create a patch (notice the order: old then new):
</p>
<pre class="example">
diff -u hello.c hello_new.c &gt; hello.patch
diff -Naur /usr/src/openvpn-2.3.2 /usr/src/openvpn-2.3.4 &gt; openvpn.patch
</pre>

<p>
To apply a patch
</p>
<pre class="example">
patch -p3 &lt; /path/to/openvpn.patch
patch -p1 &lt;patch -d /path/to/old/file
</pre>

<p>
the number after <code>p</code> indicates how many the leading slashes are skipped when find the old file
</p>

<p>
To reverse (un-apply) a patch:
</p>

<pre class="example">
patch -p1 -R &lt;patch
</pre>

<p>
This works as if you swapped the old and new file when creating the patch.
</p>
</div>
</div>

<div id="outline-container-org6b9c825" class="outline-3">
<h3 id="org6b9c825"><span class="section-number-3">4.2</span> grep</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">-i: &#24573;&#30053;&#22823;&#23567;&#20889;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">-n: &#26174;&#31034;&#34892;&#21495;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">-v: &#36755;&#20986;&#19981;&#21305;&#37197;&#30340;&#34892;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">-H: &#21516;&#26102;&#36755;&#20986;&#27492;&#34892;&#25152;&#22312;&#30340;&#25991;&#20214;&#21517;</span>
grep &lt;pattern&gt; &lt;file&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org630a880" class="outline-3">
<h3 id="org630a880"><span class="section-number-3">4.3</span> tr: translate characters</h3>
<div class="outline-text-3" id="text-4-3">
<p>
tr &lt;string1&gt; &lt;string2&gt;
</p>

<p>
the characters in string1 are translated into the characters in string2
where the first character in string1 is translated into the first character in string2 and so on.  If string1 is longer than string2,
the last character found in string2 is duplicated until string1 is exhausted.
</p>

<p>
characters in the string can be:
</p>

<p>
any characters will represent itself if not:
</p>

<ul class="org-ul">
<li><code>\\octal</code>: A backslash followed by 1, 2 or 3 octal digits</li>
<li><code>\n</code>, <code>\t</code></li>
<li><code>a-z</code>: inclusive, ascending</li>
<li><code>[:class:]</code>: space, upper, lower, alnum
<ul class="org-ul">
<li>if <code>[:upper:]</code> and <code>[:lower:]</code> appears in the same relative position, they will correlate.</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org84c141c" class="outline-3">
<h3 id="org84c141c"><span class="section-number-3">4.4</span> uniq: report or filter out repeated lines in a file</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Repeated lines in the input will not be detected if they are not adjacent,
so it may be necessary to sort the files first.
</p>

<ul class="org-ul">
<li><code>uniq -c</code>: Precede each output line with the count of the number of
times the line occurred in the input, followed by a single
space. You can then comtine this with <code>sort -n</code></li>
<li><code>-u</code>: Only output lines that are not repeated in the input.</li>
<li><code>-i</code>: Case insensitive comparison of lines.</li>
</ul>
</div>
</div>

<div id="outline-container-orgf0de125" class="outline-3">
<h3 id="orgf0de125"><span class="section-number-3">4.5</span> Other</h3>
<div class="outline-text-3" id="text-4-5">
<ul class="org-ul">
<li><code>cat</code>: <code>-n</code> output with line number</li>
<li>tail
<ul class="org-ul">
<li><code>-&lt;n&gt;</code> 显示后n行</li>
<li><code>+&lt;n&gt;</code> 显示第n行到结尾</li>
<li><code>-F</code> 跟踪显示不断增长的文件结尾</li>
</ul></li>
<li>column -s , -t xxx.csv</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgf254733" class="outline-2">
<h2 id="orgf254733"><span class="section-number-2">5</span> System Management</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgebeb393" class="outline-3">
<h3 id="orgebeb393"><span class="section-number-3">5.1</span> man</h3>
<div class="outline-text-3" id="text-5-1">
<p>
<code>man [num] &lt;item&gt;</code>
</p>
<ul class="org-ul">
<li><code>2</code>: system call, kernel function</li>
<li><code>3</code>: library call</li>
</ul>
</div>
</div>

<div id="outline-container-org44214ae" class="outline-3">
<h3 id="org44214ae"><span class="section-number-3">5.2</span> sort</h3>
<div class="outline-text-3" id="text-5-2">
<ul class="org-ul">
<li><code>-n</code>: compare according to string numerical value</li>
<li><code>-r</code>: reverse</li>
</ul>
</div>
</div>

<div id="outline-container-orgf3983ad" class="outline-3">
<h3 id="orgf3983ad"><span class="section-number-3">5.3</span> xargs</h3>
<div class="outline-text-3" id="text-5-3">
<p>
相当于~~，并把输出放 <i>结尾</i>
</p>
<div class="org-src-container">
<pre class="src src-shell">find /etc -name <span style="color: #8b2252;">'*.conf'</span> | xargs ls -l
<span style="color: #b22222;"># </span><span style="color: #b22222;">the same as:</span>
ls -l ~find ...~
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab7961c" class="outline-3">
<h3 id="orgab7961c"><span class="section-number-3">5.4</span> Find</h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">
<pre class="src src-shell">find . -type f -name *.flac -exec mv {} ../out/ <span style="color: #8b2252;">\;</span>
</pre>
</div>
<p>
Copy file based on find, and take care of quotes and spaces:
</p>
<div class="org-src-container">
<pre class="src src-shell">find CloudMusic -type f -name <span style="color: #8b2252;">"*mp3"</span> -exec cp <span style="color: #8b2252;">"{}"</span> all_music <span style="color: #8b2252;">\;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org524948d" class="outline-3">
<h3 id="org524948d"><span class="section-number-3">5.5</span> Filesystem related</h3>
<div class="outline-text-3" id="text-5-5">
<p>
from relative path to absolute path
</p>
<div class="org-src-container">
<pre class="src src-shell">realpath -f /relative/path <span style="color: #b22222;"># </span><span style="color: #b22222;">this will follow symbolic link</span>
</pre>
</div>

<p>
<code>du</code>: estimate file space usage
</p>
<div class="org-src-container">
<pre class="src src-shell">du -sm * | sort -nr
</pre>
</div>
</div>
</div>

<div id="outline-container-org6351ba5" class="outline-3">
<h3 id="org6351ba5"><span class="section-number-3">5.6</span> unzip</h3>
<div class="outline-text-3" id="text-5-6">
<ul class="org-ul">
<li><code>-o</code> overwrite existing file without prompt</li>
<li><code>-d</code> extract to specified directory</li>
</ul>
</div>
</div>


<div id="outline-container-org9026d7a" class="outline-3">
<h3 id="org9026d7a"><span class="section-number-3">5.7</span> tar</h3>
<div class="outline-text-3" id="text-5-7">
<p>
tar zcvf file.tar.gz &#x2013;exclude=a.out &#x2013;exclude=*.gmout folder
</p>
<ul class="org-ul">
<li>exclude must come before folder</li>
<li>exclude use shell pattern</li>
<li>exclude can be specified multiple times</li>
</ul>
</div>
</div>

<div id="outline-container-org01dcf21" class="outline-3">
<h3 id="org01dcf21"><span class="section-number-3">5.8</span> Other</h3>
<div class="outline-text-3" id="text-5-8">
<ul class="org-ul">
<li><code>time &lt;command&gt;</code>: # the total user and system time consumed by the shell and its children</li>
<li><code>column</code>: formats its input into multiple columns. <code>mount | column -t</code></li>
<li><code>dd</code>: <code>dd if=xxx.iso of=/dev/sdb bs=4m; sync</code></li>
<li><code>convert</code>: <code>convert xxx.jpg -resize 800 xxx.out.jpg # 800x&lt;height&gt;</code></li>
<li><code>nl</code>: <code>nl &lt;filename&gt;</code> 添加行号。输出到stdout</li>
<li><code>ln</code>: <code>ln -s &lt;target&gt; &lt;linkname&gt;</code> 记忆：新的东西总要最后才发布。</li>
<li><code>ls</code>: order: <code>-r</code> reverse; <code>-s</code> file size; <code>X</code> extension; <code>-t</code> time</li>
<li><code>tree</code>
<ul class="org-ul">
<li><code>-d</code> 只显示目录</li>
<li><code>-f</code> 显示路径</li>
<li><code>-F</code> 条目后有 [\*/=@|]</li>
<li><code>-r</code> 倒序</li>
<li><code>-t</code> 修改时间排序</li>
<li><code>-L(\d)</code> 显示n层</li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Hebi Li</p>
<p class="date">Created: 2017-11-20 Mon 10:50</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
